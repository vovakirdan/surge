// Valid: Task passed to function (ownership transfer)
// When a Task<T> is passed as argument, caller transfers ownership to callee

async fn compute() -> int {
    return 42;
}

// Async function that receives and awaits a spawn
async fn drain_task(t: Task<int>) -> int {
    return compare t.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
}

// Valid: spawn passed to drain, then await drainer
pub async fn test_pass_and_await_drainer() -> int {
    let t = spawn compute();
    let drainer = spawn drain_task(t);  // ownership of 't' transferred to drain_task
    return compare drainer.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
}

// Valid: direct spawn passed without intermediate binding
pub async fn test_direct_pass() -> int {
    let drainer = spawn drain_task(spawn compute());
    return compare drainer.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
}

// Valid: multiple tasks passed to different functions
async fn sum_tasks(t1: Task<int>, t2: Task<int>) -> int {
    let v1: int = compare t1.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
    let v2: int = compare t2.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
    return v1 + v2;
}

pub async fn test_multiple_pass() -> int {
    let a = spawn compute();
    let b = spawn compute();
    let summer = spawn sum_tasks(a, b);  // both a and b transferred
    return compare summer.await() {
        Success(v) => v;
        Cancelled() => 0;
    };
}
