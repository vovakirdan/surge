// ยง11 Error Handling Model Audit

// Erring type with Success tag
fn maybe_fail(succeed: bool) -> Erring<int, Error> {
    if (succeed) {
        return Success(42);
    }
    let e: Error = { message: "failed", code: 1:uint };
    return e;
}

// Option type
fn maybe_value(has: bool) -> Option<int> {
    if (has) {
        return Some(10);
    }
    return nothing;
}

fn try_parse() -> int! {
    return Success(42);
}

@entrypoint
fn main() {
    // Test Success case
    let r1: Erring<int, Error> = maybe_fail(true);
    let v1: string = compare r1 {
        Success(v) => "Success: " + v to string;
        err => "Error: " + err.message;
    };
    print("Erring success: " + v1);

    // Test Error case
    let r2: Erring<int, Error> = maybe_fail(false);
    let v2: string = compare r2 {
        Success(v) => "Success: " + v to string;
        err => "Error: " + err.message;
    };
    print("Erring error: " + v2);

    // Test Option
    let o1: Option<int> = maybe_value(true);
    let v3: string = compare o1 {
        Some(v) => "Some: " + v to string;
        nothing => "None";
    };
    print("Option some: " + v3);

    let o2: Option<int> = maybe_value(false);
    let v4: string = compare o2 {
        Some(v) => "Some: " + v to string;
        nothing => "None";
    };
    print("Option none: " + v4);

    // ยง11 T! sugar
    let r3: int! = try_parse();
    let v5: string = compare r3 {
        Success(v) => "Success: " + v to string;
        err => "Error: " + err.message;
    };
    print("T! sugar: " + v5);

    print("ยง11 Error Handling: PASS");
    print("  - Erring Success: PASS");
    print("  - Erring Error: PASS");
    print("  - Option: PASS");
    print("  - T!/T? sugar: PASS");
}
