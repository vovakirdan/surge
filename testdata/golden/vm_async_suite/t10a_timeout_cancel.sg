async fn run() -> int {
    let worker = spawn async {
        sleep(30).await();
        print("worker done");
        return 1;
    };

    let r = timeout(worker, 5);
    compare r {
        Success(v) => print("ok=" + (v to string));
        Cancelled() => print("result=timeout");
    };

    let guard = spawn async {
        sleep(60).await();
        return 0;
    };
    let _ = guard.await();

    return 0;
}

@entrypoint
fn main() -> int {
    let exit_code: int = compare run().await() {
        Success(v) => v;
        Cancelled() => 1;
    };
    return exit_code;
}
