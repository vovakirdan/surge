pragma no_std;
// Core Result type, a tagged union for recoverable errors.

// stub for test
// PLEASE REMOVE THIS IF U COPY TO CORE MODULE
pub fn default<T>() -> T;
pub fn exit<E>(e: E) -> nothing;

pub contract ErrorLike{
    field message: string;
    field code: uint;
}

pub tag Some<E>(E);
pub type Option<E> = Some(E) | nothing;
// ------------------------------------

// Core Erring type for recoverable errors using ErrorLike contract.

pub type Error = { message: string, code: uint };

pub tag Success<T>(T);
pub type Erring<T, E: ErrorLike> = Success(T) | E;

extern<Erring<T, E>> {
    pub fn safe<T, E: ErrorLike>(self: Erring<T, E>) -> T {
        compare self {
            Success(v) => v;
            _ => default::<T>();
        };
    }

    pub fn exit<T, E: ErrorLike>(self: Erring<T, E>) -> nothing {
        compare self {
            Success(_) => return nothing;
            err => exit(err);
        };
    }

    pub fn error<T, E: ErrorLike>(self: Erring<T, E>) -> Option<E> {
        compare self {
            Success(_) => nothing;
            err => Some(err);
        };
    }

    pub fn is_success(self: Erring<T, E>) -> bool {
        compare self {
            Success(_) => true;
            _ => false;
        };
    }

    pub fn is_error(self: Erring<T, E>) -> bool {
        compare self {
            Success(_) => false;
            _ => true;
        };
    }
}
