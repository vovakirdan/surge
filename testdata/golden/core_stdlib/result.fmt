pragma module, no_std;

// Core Erring type for recoverable errors using ErrorLike contract.

pub type Error = { message: string, code: uint };

pub tag Success<T>(T);
pub type Erring<T, E> = Success(T) | E;

extern<Erring<T, E>> {
    pub fn safe(self: Erring<T, E>) -> T {
        return compare self {
            Success(v) => v;
            _ => default::<T>();
        };
    }

    pub fn exit(self: Erring<T, E>) -> nothing {
        compare self {
            Success(_) => nothing;
            err => exit(err);
        };
    }

    pub fn error(self: Erring<T, E>) -> Option<E> {
        return compare self {
            Success(_) => nothing;
            err => Some(err);
        };
    }

    pub fn is_success(self: &Erring<T, E>) -> bool {
        return compare self {
            Success(_) => true;
            _ => false;
        };
    }

    pub fn is_error(self: &Erring<T, E>) -> bool {
        return compare self {
            Success(_) => false;
            _ => true;
        };
    }

    // Convert Erring to exit code: Success => 0, error => error.code
    pub fn __to(self: Erring<T, E>, target: int) -> int {
        return compare self {
            Success(_) => 0;
            err => err.code to int;
        };
    }
}
