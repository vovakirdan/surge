fn write_str(s: string) -> nothing {
    let ptr = rt_string_ptr(&s);
    let n = rt_string_len_bytes(&s);
    rt_write_stdout(ptr, n);
}

fn write_line(s: string) -> nothing {
    write_str(s);
    let nl = "\n";
    rt_write_stdout(rt_string_ptr(&nl), 1:uint);
}

fn print_uint(u: uint) -> nothing {
    write_line(u to string);
}

@entrypoint
fn main() -> int {
    let mut r: string = "";
    let mut i: int = 0;
    while i < 5 {
        r = r + "hi,";
        i = i + 1;
    }
    r = r + "end";

    let parts = r.split(",");
    write_line("-".join(parts));

    write_line("[" + ("  " + r + "  ").trim() + "]");
    write_line("[" + ("  " + r).trim_start() + "]");
    write_line("[" + (r + "  ").trim_end() + "]");

    write_line(r.replace("hi", "yo"));
    let rev = r.reverse();
    write_line(rev.__clone());

    let last_cp: uint = r[-1] to uint;
    print_uint(last_cp);
    write_line(rev[[..-1]]);

    let mut left: string = "";
    left = left + "ab";
    left = left + "cd";
    print_uint(left.levenshtein("abxd"));

    let bv = r.bytes();
    print_uint(bv.__len());
    let first: uint = bv[0] to uint;
    print_uint(first);

    let r2 = r.replace("hi", "ha");
    rt_string_force_flatten(&r2);
    let bv2 = r2.bytes();
    print_uint(bv2.__len());
    let last_idx: int = (bv2.__len() - 1:uint) to int;
    let last_byte: uint = bv2[last_idx] to uint;
    print_uint(last_byte);

    let small = "ok";
    let from = rt_string_from_bytes(rt_string_ptr(&small), rt_string_len_bytes(&small));
    write_line(from);

    return 0;
}
