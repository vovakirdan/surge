fn write_str(s: string) -> nothing {
    let ptr = rt_string_ptr(&s);
    let n = rt_string_len_bytes(&s);
    rt_write_stdout(ptr, n);
}

fn write_line(s: string) -> nothing {
    write_str(s);
    let nl = "\n";
    rt_write_stdout(rt_string_ptr(&nl), 1:uint);
}

fn print_uint(u: uint) -> nothing {
    write_line(u to string);
}

@entrypoint
fn main() -> int {
    let mut s: string = "";
    let mut i: int = 0;
    while i < 200 {
        s = s + "a";
        i = i + 1;
    }

    write_line(s[[0..3]]);
    write_line(s[[-3..]]);
    let mid = s[[10..20]];
    write_line(s[[10..20]]);
    write_line(s[[0..=1]]);

    let bv = rt_string_bytes_view(&s);
    print_uint(bv.__len());
    let b0: uint = bv[0] to uint;
    print_uint(b0);
    print_uint(rt_string_len(&s));

    let u = "aðŸ™‚b";
    let u_cp: uint = u[1] to uint;
    print_uint(u_cp);
    let u_slice = u[[1..2]];
    print_uint(rt_string_len(&u_slice));
    print_uint(rt_string_len_bytes(&u_slice));
    let u_slice_cp: uint = u_slice[0] to uint;
    print_uint(u_slice_cp);
    let last_c: uint = "abc"[-1] to uint;
    print_uint(last_c);
    write_line("abcdef"[[..-1]]);
    write_line("abcdef"[[1..=3]]);
    write_line("abc"[[2..1]]);

    rt_string_force_flatten(&s);
    let s2 = s + "";
    write_line(s2[[0..3]]);
    print_uint(rt_string_len_bytes(&s2));
    let bv2 = rt_string_bytes_view(&s2);
    print_uint(bv2.__len());
    let last_idx: int = (bv2.__len() - 1:uint) to int;
    let last_byte: uint = bv2[last_idx] to uint;
    print_uint(last_byte);

    rt_string_force_flatten(&mid);
    print_uint(rt_string_len_bytes(&mid));

    return 0;
}
