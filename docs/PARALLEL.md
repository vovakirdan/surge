# **üìå –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã—Å–æ–∫–∞—è –º–æ–¥–µ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ Surge (Draft 1)**

---

# **1. –ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø: ‚ÄúGo-–ø—Ä–æ—Å—Ç–æ—Ç–∞, Rust-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å‚Äù**

Surge –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **–º–æ–¥–µ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é**, –ø–æ—Ö–æ–∂—É—é –Ω–∞ Go:

```
spawn foo()
```

–ù–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è Rust:

* –Ω–µ—Ç data-race,
* –Ω–µ—Ç shared mutable state –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π,
* –Ω–µ—Ç dangling references.

–¢–æ –µ—Å—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Ç–∞–∫–∞—è:

> **–ù–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫ Go, –ø–æ–ª—É—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–∞–∫ Rust, –±–µ–∑ async-–∑–æ–æ–ø–∞—Ä–∫–∞ Python.**

---

# **2. –¢—Ä–∏ —Å—Ç–æ–ª–ø–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ Surge**

### **2.1. –õ—ë–≥–∫–∏–µ –∑–∞–¥–∞—á–∏ (`spawn`) ‚Äî –∫–∞–∫ goroutines**

```
let t = spawn some_work(arg1, arg2);
let result = t.await;
```

**spawn = –ª—ë–≥–∫–∞—è –∑–∞–¥–∞—á–∞**, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ.
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Task<T>` —Å `await`.

–ü—Ä–∞–≤–∏–ª–∞:

* –≤–Ω—É—Ç—Ä—å `spawn` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ `own T`**
* –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `&T` / `&mut T`
* borrow-checker —ç—Ç–æ –ª–æ–≤–∏—Ç

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ: **–Ω–∏–∫–∞–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç –≥—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—á**.

---

### **2.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (`async` / `await`) ‚Äî –∫–∞–∫ Swift/Rust**

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ lightweight-–ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –±–ª–æ–∫–∏.

```
async fn load() -> Data { ... }
let data = load().await;
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

* `await` —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `async` –∏–ª–∏ `spawn`
* –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ async-–±–ª–æ–∫–∞ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ spawn-–∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è (structured concurrency)
* async —Ç–æ–∂–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç ‚Äú–≤—ã–Ω–æ—Å–∏—Ç—å borrows –Ω–∞—Ä—É–∂—É‚Äù

**–ü—Ä–∏–Ω—Ü–∏–ø**: async ‚Äî —ç—Ç–æ –Ω–µ ‚Äú–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å‚Äù, —ç—Ç–æ ‚Äú–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏‚Äù.
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ spawn.

---

### **2.3. –ö–∞–Ω–∞–ª—ã (channel<T>) ‚Äî –∫–∞–∫ Go**

```
let ch = make_channel<int>(10);
spawn producer(ch);
spawn consumer(ch);
```

–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

* —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ FIFO-–∫–∞–Ω–∞–ª—ã
* API: send / recv / try_recv / recv_timeout / close
* –Ω–µ—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ shared –¥–æ—Å—Ç—É–ø–∞

–ö–∞–Ω–∞–ª—ã ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏.

---

# **3. –ú–æ–¥–µ–ª—å –ø–∞–º—è—Ç–∏: ‚Äú–Ω–∏—á–µ–≥–æ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–≥–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é‚Äù**

### **3.1. –ü–µ—Ä–µ–¥–∞—á–∞ –≤ –∑–∞–¥–∞—á—É ‚Äî —Ç–æ–ª—å–∫–æ `own`**

–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–∞–∫ –∑–∞–∫–æ–Ω —è–∑—ã–∫–∞:

```
spawn foo(&x);  // –æ—à–∏–±–∫–∞
spawn foo(x);   // –ø–µ—Ä–µ–Ω–æ—Å
```

–ü—Ä–∏—á–∏–Ω—ã:

* –Ω–µ—Ç data race,
* –Ω–µ—Ç cross-thread borrow lifetime,
* borrow-checker –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º.

### **3.2. –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∑–∞–¥–∞—á–∏ —Ç–æ–∂–µ `own`**

`task.await` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ownership —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

### **3.3. –ù–µ—Ç shared mutable state –±–µ–∑ —è–≤–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π**

–¢–æ –µ—Å—Ç—å —á—Ç–æ–±—ã —à–∞—Ä–∏—Ç—å –ø–∞–º—è—Ç—å –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

* –∫–∞–Ω–∞–ª—ã,
* `@shared` —Ç–∏–ø—ã,
* `Mutex` / `RwLock` (–∏–∑ stdlib).

–ù–æ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫:

```
let mut x = 0;
spawn { x = x + 1 };   // –Ω–∏–∫–æ–≥–¥–∞
```

---

# **4. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å borrow-checker –∏ @drop**

### **4.1. –î–æ–∫—Ç—Ä–∏–Ω–∞: borrow-checker ‚Äú–∑–∞–º—ã–∫–∞–µ—Ç‚Äù –º–∏—Ä –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏**

–£ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ —Å–≤–æ—ë –æ—Ç–¥–µ–ª—å–Ω–æ–µ borrow-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

* –Ω–µ–ª—å–∑—è –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å borrow —Ç—É–¥–∞,
* –Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å borrow –æ–±—Ä–∞—Ç–Ω–æ,
* –Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏.

–¢–æ–ª—å–∫–æ `own` –∏ –∑–Ω–∞—á–µ–Ω–∏—è.

### **4.2. –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å borrows –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ @drop**

```
let r = &data;
/* ... */
@drop r;  // –ª–æ–∫–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è
spawn do_work(data);   // —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ, borrow —Å–Ω—è—Ç
```

–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å `@drop` ‚Äî –∫–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç:

> **@drop –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º –ø–µ—Ä–µ–¥–∞—á—É ownership –≤ spawn, –æ—Å–≤–æ–±–æ–∂–¥–∞—è borrow —Ç–æ—á–Ω–æ –ø–æ –º–µ—Å—Ç—É.**

–ë–µ–∑ –Ω–µ–≥–æ borrow –±—ã –∂–∏–ª –¥–æ –∫–æ–Ω—Ü–∞ –±–ª–æ–∫–∞.

---

# **5. –°–∏–Ω—Ç–∞–∫—Å–∏—Å ‚Äî —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞**

### **5.1. `spawn expr`**

–ó–∞–ø—É—Å–∫–∞–µ—Ç expr –≤ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ.
`expr` –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∏–ø `T`, —Ç–æ–≥–¥–∞:

```
spawn expr  : Task<T>
```

### **5.2. `async fn` –∏ `async { ... }`**

–û–±–∞ —Å–æ–∑–¥–∞—é—Ç Future-–∑–Ω–∞—á–µ–Ω–∏–µ.

### **5.3. `.await`**

–ú–µ—Ç–æ–¥ –Ω–∞ Future/Task, –≤—ã–¥–∞—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### **5.4. –ö–∞–Ω–∞–ª—ã**

```
make_channel<T>(cap)
send(&ch, value: own T)
recv(&ch) -> Option<T>
```

### **5.5. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã**

```
parallel map xs with (...) => f
parallel reduce xs with init, (...) => f
```

–¢—Ä–µ–±—É—é—Ç @pure —á–∏—Å—Ç–æ—Ç—ã.

---

# **6. Safety-–ø—Ä–∞–≤–∏–ª–∞ (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä):**

1. **–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å borrow –≤ –∑–∞–¥–∞—á—É**
   `SemaBorrowThreadEscape`.

2. **–ù–µ–ª—å–∑—è –º—É—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –∂–∏–≤—ã—Ö &borrows**
   –∫–∞–∫ —Å–µ–π—á–∞—Å ‚Äî –æ–±—ã—á–Ω—ã–µ borrow-–ø—Ä–∞–≤–∏–ª–∞.

3. **–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await` –≤–Ω–µ async**

4. **–ù–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å `await` —É Future**
   (–∫–∞–∫ –≤ Rust, –∏–Ω–∞—á–µ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è) ‚Üí warning / error.

5. **–í—Å–µ –∑–∞–¥–∞—á–∏ –≤ async-–±–ª–æ–∫–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –±–ª–æ–∫—É**
   Structured concurrency.

6. **@drop —Ç–æ–ª—å–∫–æ –Ω–∞ statement**, —É–±–∏—Ä–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π borrow.
   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç spawn-—É –±—Ä–∞—Ç—å ownership –æ–±—ä–µ–∫—Ç–∞ –ø–æ–∑–∂–µ.

7. **–ù–µ–ª—å–∑—è –±—Ä–æ—Å–∞—Ç—å channels –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞**
   –ø–µ—Ä–µ–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å own ‚Äî –∏ —ç—Ç–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ.

---

# **7. –ú–æ–¥–µ–ª—å –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏**

### **7.1. Move-only –º–æ–¥–µ–ª—å**

```
spawn worker(x);   // x –ø–µ—Ä–µ–µ—Ö–∞–ª
```

### **7.2. –ö–∞–Ω–∞–ª—ã ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ‚Äú—Ä–∞–∑–¥–µ–ª—è–µ–º–æ—Å—Ç–∏‚Äù**

```
spawn { send(&ch, item); }
spawn { let v = recv(&ch); }
```

### **7.3. @shared –∏ lock-–∏ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—á–µ–Ω—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤**

* `Mutex`,
* `RwLock`,
* —Ç–∏–ø—ã —Å `@shared`,
* fn —Å @requires_lock / @acquires_lock.

–≠—Ç–æ –Ω—É–∂–Ω–æ –ª–∏—à—å –¥–ª—è advanced users, –Ω–µ –¥–ª—è –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª–∏.

---

# **8. –ò—Ç–æ–≥–æ: –ø–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –≤ –æ–¥–Ω–æ–º –∞–±–∑–∞—Ü–µ ‚Äî —Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è**

Surge —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ª—ë–≥–∫–∏–µ –∑–∞–¥–∞—á–∏ (`spawn`), —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (`async`/`await`) –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã. –ü–∞–º—è—Ç—å –Ω–µ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏: –≤–Ω—É—Ç—Ä—å –∑–∞–¥–∞—á –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `own`-–∑–Ω–∞—á–µ–Ω–∏—è, –Ω–∏–∫–∞–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç –≥—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—á, –∏ borrow-checker –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ data race. –ê—Ç—Ä–∏–±—É—Ç `@drop` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–æ –∫–æ–Ω—Ü–∞ –±–ª–æ–∫–∞, enabling –ø–µ—Ä–µ–¥–∞—á—É ownership –≤ –∑–∞–¥–∞—á—É. Async-–±–ª–æ–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç structured concurrency ‚Äî –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –±–ª–æ–∫–∞. –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã mutexes/rwlocks –∏ —Ç–∏–ø—ã `@shared`, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Surge —Å–ª–µ–¥—É–µ—Ç –º–æ–¥–µ–ª–∏ ‚ÄúGo-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å, Rust-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å‚Äù.
